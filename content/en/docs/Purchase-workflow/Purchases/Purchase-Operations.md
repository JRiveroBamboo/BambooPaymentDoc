---
title: "Operations"
linkTitle: "Operations"
date: 2023-03-02T11:40:29-05:00
Description: >
  Create a purchase using the API flow providing its basic information. Furthermore, explore the different operations over existing purchase.
weight: 10
tags: ["subtopic"]
---

## Configuring the authentication
All methods used in Purchase API requires an authentication header, which is configured using the following parameters.

| Key | Value | Comments |
|---|---|---|
| `Content-Type` | `application/json` | This parameter causes the request to be sent in _json_ format.  |
| `Authorization` | `Basic {{Merchant Private Key}}` | Sent the `{{Merchant Private Key}}` (your merchant identifier) and the word `Basic`.<br>Example: `Basic RVkeLr-86_iTzSMLvDtuyQ-1zqIcsmFG-oSzncn_uFv-nj7bhB3rtZg__` |

## Setting the language of the response codes
You can receive the error description by relying on localization features. To do this, you need to send the `lang` header in your integration, using any of the following languages in **ISO 639-1** format.

<div id="shortTable"></div>

| Code | Language |
|:-:|---|
| `en` | English.<br>_This is the default language. If you don't send this header or set a non-existent language, you will receive errors in this language._ |
| `es` | Spanish. |
| `pt` | Portuguese. |

## Purchase API methods
The operations exposed by the _**Purchase API**_ allows you to performs several actions over Purchases. Ypu have available the following methods.

* [Create a purchase](#create-a-purchase)
* [Confirm a purchase](#confirm-a-purchase)
* [Get purchases](#get-purchases)

### Create a purchase
Create a basic purchase in Bamboo Payment.

#### Request URL
You need to invoke a **POST** request to the following URLs according to your needs.

* **Production**: `https://secure-api.bamboopayment.com/v1/api/purchase`
* **Stage**: `https://secure-api.stage.bamboopayment.com/v1/api/purchase`

#### Request parameters

| Parameter | Type | Mandatory? | Description |
|---|---|---|---|
| `PaymentMediaId` | `integer` | No <sup>1</sup> | Corresponds to the Id of the payment method you want to use. This parameter is only for Alternative payment methods (transfer, cash and processing that requires customer redirection). |
| `TrxToken` | `string` | No <sup>1</sup> | Token that identifies the customer's card. |
| `Order` | `string` | Yes | Order number generated by the merchant. |
| `Amount` | `number` | Yes | Amount of the purchase. This value must be greater than zero.<br>If you require to include decimals in the amount, concatenate the decimal places without de decimal point. Example `12,25` > `1225`. |
| `Currency` | `string` | Yes | Currency of the purchase, according to ISO-4217. The possible values are found in the [Currencies](#) table. |
| `Installments` | `integer` | No | Number of payments in which is divided a credit card purchase. |
| `Capture` | `boolean` | No | Defines whether the purchase should be performed in one or two steps.<sup>2</sup><br><ul style="margin-bottom: initial;"><li>If `false`, only the authorization is processed and the purchase is pre-authorized pending final confirmation through the commit and rollback calls.</li><li>If `true`, the transaction is authorized and captured (committed).</li></ul><br>Pre-authorization feature may not be supported by all [payment methods and countries](/docs/payment-methods.html). |
| `CrossBorderData` | `object` | No <sup>3</sup> | This object has the information related to _CrossBorder purchases_. |
| `CrossBorderData` → `TargetCountryISO` | `string` | Yes | This parameter indicates the country where the payment will be processed.<br>The country must be sent using `ISO-3166-1` format |
| `MetadataIn` | `object` | No | Additional fields required by each payment method or acquirer. |
| `Customer` | `object` | Yes <sup>4</sup> | The Customer object is used to provide the data of the customer who performs the purchase. |
| `Customer` → `CommerceCustomerId` | `string` | No | Customer identifier.<br>This value is generated and used internally by the merchant to identify the customer within the Bamboo Payment platform. |
| `Customer` → `Email` | `string` | Yes | Customer email address. |
| `Customer` → `FirstName` | `string` | No | Customer name. |
| `Customer` → `LastName` | `string` | No | Customer last name. |
| `Customer` → `PhoneNumber` | `string` | No | Customer contact telephone number. |
| `Customer` → `Enabled` | `boolean` | No | Indicates whether the user is enabled to operate. Default value is `true`. |
| `Customer` → `BillingAddress` | `object` | No | The billing address of the customer. This address is related to the address associated to the card. |
| `Customer` → `BillingAddress`→`AddressID` | `integer` | No | Address Identifier. |
| `Customer` → `BillingAddress`→`AddressType` | `string` | No | Type of address. |
| `Customer` → `BillingAddress`→`Country` | `string` | No | Country of the address. |
| `Customer` → `BillingAddress`→`State` | `string` | No | State of the address. |
| `Customer` → `BillingAddress`→`City` | `string` | No | City of the address. |
| `Customer` → `BillingAddress`→`AddressDetail` | `string` | No | Additional information of the address, such as street, number, etc. |
| `Customer` → `BillingAddress`→`PostalCode` | `string` | No | Postal Code of the address. |
| `Customer` → `ShippingAddress` | `object` | No | The shipping address of the customer. This is the address provided by the customer where they want to receive the product purchased. This object has the same parameter than the `Customer.BillingAddress` object. |
| `Customer` → `AdditionalData` | `string` | No | List of type `key:value` to store extra information. |
| `Customer` → `CaptureURL` | `string` | No | Card data capture URL.<br>This is the URL that must be opened in an iframe to start the process of capturing sensitive data.<br>Only applies for Customers of type _Commerce_. |
| `Customer` → `DocumentTypeId` | `string` | No | Customer document type. The possible values are found in the [Document types](#) table. |
| `Customer` → `DocNumber` | `string` | No | Customer document Number. |
| `Tip` | `number` | No | Additional tip of the purchase if required. |
| `Description` | `string` | No | Optional description of the purchase. |
| `UniqueID` | `string` | No | Unique identifier of the purchase.<br>This optional value allows to identify a unique purchase and avoid duplication of transactions in case of communication errors. For more information, refer [Concepts]({{< ref "Concepts.md">}}#UniqueID). |
| `AdditionalData` | `string` | No | Additional information that you can add to the transaction (For example a `Key:Value` data list).<br>This information will be returned after we process the purchase and each time you consult the purchase. |
| `CustomerUserAgent` | `string` | No | User Agent of the customer who uses the service, For desktop devices it should be the `UserAgent` reported by the browser, and for mobile, the information about the device, S.O. used, App name. |
| `CustomerIP` | `string` | No | IP of the customer that uses the service. |
| `DataUY` | `object` | No <sup>5</sup> | Specific data for _Uruguay_.<br>In Uruguay, exist two laws that benefit the use of electronic payment methods through the refund of VAT points to this transactions. The Law **19,210** (Financial inclusion law) and the law **17,934** for gastronomic and related services, govern these benefits and the data presented in this object is necessary for the correct usage. |
| `DataUY` → `IsFinalConsumer` | `boolean` | No <sup>6</sup> | Indicates if the sale is performed to a final consumer. |
| `DataUY` → `Invoice` | `string` | No <sup>6</sup> | Invoice number associated with the sale. |
| `DataUY` → `TaxableAmount` | `number` | No <sup>6</sup> | Amount taxed by VAT. |

{{% alert title="Notes" color="info"%}}
* <sup>1</sup> The `PaymentMediaId` and `TrxToken` fields are not required. Nevertheless, it's mandatory to send one of them depending on the flow you want to use.<br>
* <sup>2</sup> Pre-authorization feature may not be supported by all the payment methods. Review the [Countries and payment methods](/docs/payment-methods.html) section to check availability.
* <sup>3</sup> This parameter is mandatory when creating _CrossBorder purchases_.
* <sup>4</sup> If you create the purchase using a [_CommerceToken_](#), This object is not required.
* <sup>5</sup> This parameter is mandatory for _Uruguay_ using cards.
* <sup>6</sup> This parameter is mandatory when `DataUY.IsFinalConsumer` is `true`.
* Keep in mind that for the correct functioning of the Antifraud system, it is suggested to send additional data which is described in the [Antifraud]({{< ref "Antifraud.md" >}}) section.
{{% /alert %}}

##### Request example

```json
{
  "TrxToken":"OT__zq4aTY4T9TzSldeBKry-Wbx75QNbuT894jiYpVJ8SzQ_",
  "Order": "099927564",
  "Capture": true,
  "Amount": "10000",
  "Currency": "UYU",
  "Installments": 1,
  "Customer": {
    "Email": "john@bamboopayment.com",
    "FirstName": "John",
    "LastName": "Smith",
    "DocNumber": "12345672",
    "DocumentTypeId": 2,
    "PhoneNumber": "24022330",
    "BillingAddress": {
      "AddressType": 1,
      "Country": "Uruguay",
      "State": "Montevideo",
      "City": "MONTEVIDEO",
      "AddressDetail": "Av. Sarmiento 2260",
      "PostalCode": "150000"
    }
  },
  "DataUY": {
    "IsFinalConsumer": "true",
    "Invoice": "1000",
    "TaxableAmount": 0
  }
}
```

### Confirm a purchase
This method allows you to confirm a pre-authorized purchase.

{{% alert title="Note" color="info"%}}
Pre-authorization feature may not be supported by all payment methods and it's available for the following countries.

<div style="text-align: center;">

<a href="/docs/payment-methods/brazil.html"><img src="/assets/Flags/FlagBR.png" width="30" /></a>
<a href="/docs/payment-methods/chile.html"><img src="/assets/Flags/FlagCL.png" width="30" /></a>
<a href="/docs/payment-methods/uruguay.html"><img src="/assets/Flags/FlagUY.png" width="30" /></a>

</div>

{{% /alert %}}

#### Request URL
You need to invoke a **POST** request to the following URLs according to your needs.

* **Production**: `https://secure-api.bamboopayment.com/v1/api/purchase/{{PurchaseID}}/commit`
* **Stage**: `https://secure-api.stage.bamboopayment.com/v1/api/purchase/{{PurchaseID}}/commit`

#### Request parameters
Request body is not required to confirm a purchase. If you don't send any request the pre-authorized purchase will be confirmed with its original amount. 

The amount of the purchase may vary with respect to the one that was sent in the initial Purchase process, but the new amount cannot be higher than the original amount.

##### Request example
To confirm a purchase with a lower amount than the original, you need to include the new amount in the request. For example:

```json
{
  "Amount": 50
}
``` 

### Get Purchases
This method allows you to get the information of one or more purchases given the search criteria sent in the body.

#### Request URL
You need to invoke a **GET** request to the following URLs according to your needs.

* **Production**: `https://secure-api.bamboopayment.com/v1/api/purchase`
* **Stage**: `https://secure-api.stage.bamboopayment.com/v1/api/purchase`

To get a specific purchase, include in the URL `/{{PurchaseID}}`. Example: `https://secure-api.bamboopayment.com/v1/api/purchase/481561`.

#### Request parameters
The following parameters are only required when you want to get a list of purchases. When requesting a specific purchase just add the _PurchaseID_ to the Request URL.

{{% alert title="Note" color="info"%}}
All the parameters are optional. If you don't send any parameter, all the purchases performed today will be listed.
{{% /alert %}}

| Parameter | Type | Description |
|---|---|---|---|
| `Authorized` | `boolean` | If the value is `true`, it returns only purchases that have completed successfully. |
| `From` | `date` | Filter start date.<br>Format: `yyyyMMdd`. |
| `OrderNumber` | `string` | Merchant order number. |
| `PaymentMediaId` | `integer` | Identifier of the Payment Method used in the purchase. |
| `To` | `date` | Filter end date.<br>Format: `yyyyMMdd`. |


## Response parameters
Regardless of the method you invoke, you will get the same `Response` object. Only when you query purchases and the result has multiple results, the `Response` returned will be an array.

The following table describes the parameters in `Response` object that are relevant for the purchase, its possible next steps in the flow, and the errors that may have occurred.

| Parameter | Type | Description |
|---|---|---|
| `Response` | `object` | Parameters returned as result of the purchase processing. |
| `Response` → `PurchaseId` | `integer` | Purchase identifier. |
| `Response` → `Created` | `date` | Date and time when the purchase was created.<br>Date format _**ISO-8601**_. | 
| `Response` → `Transaction` | `object` | This object is associated with the Purchase and has the information on the request sent and the response obtained from the corresponding payment method. |
| `Response` → `Transaction` → `TransactionID` | `integer` | Transaction identifier. |
| `Response` → `Transaction` → `Created` | `date` | Date and time when the transaction was created.<br>Date format _**ISO-8601**_. |
| `Response` → `Transaction` → `TransactionStatusId` | `integer` | Internal identifier of the transaction status. |
| `Response` → `Transaction` → `Status` | `string` | Current status of the transaction. |
| `Response` → `Transaction` → `ErrorCode` | `string` | Error code (if applies) returned by the payment method. |
| `Response` → `Transaction` → `Description` | `string` | Description of the outcome of the transaction. |
| `Response` → `Transaction` → `ApprovalCode` | `string` | Approval code returned by the payment method. |
| `Response` → `RefundList` | `object` | This object has the information of the refunds (partials or total) of the purchase. |
| `Response` → `RefundList` → `PurchaseRefundId` | `integer` | Identifier associated with the refund. |
| `Response` → `RefundList` → `Created` | `date` | Date and time when the refund was made. |
| `Response` → `RefundList` → `UniqueID` | `string` | Unique identifier of the transaction.<br>This value allows you to identify a refund in the list of all possible refunds made. |
| `Response` → `RefundList` → `Amount` | `integer` | Total amount of the refund. |
| `Response` → `RefundList` → `Currency` | `string` | Currency of the purchase, according to ISO-4217 (alphanumeric codes). |
| `Response` → `RefundList` → `Status` | `string` | Current status of the refund. |
| `Response` → `CommerceAction` | `object` | This object is used to inform you of the different actions that you or your customer must carry out to complete the current purchase process. |
| `Response` → `MetadataOut` | `object` | Additional fields returned by each payment method or acquirer to perform the next steps.<br>For example, this object can have the URL to where you need to redirect the customer or the QR image that has to be scanned by your customer. |
| `Response` → `CrossBorderDataResponse` | `object` | This object has the information about the processed Amounts in local currency of the selected Country. |
| `Response` → `CrossBorderDataResponse` → `TargetCountryISO` | `string` | Same country sent in the request. |
| `Response` → `CrossBorderDataResponse` → `TargetCurrencyISO` | `string` | Local currency determined for the selected country. |
| `Response` → `CrossBorderDataResponse` → `TargetAmount` | `number` |Purchase amount converted to the local currency. |
| `Errors` | `list` | List of errors that can be launched during the purchase process. |
| `Errors` → `ErrorCode` | `string` | Error code returned. |
| `Errors` → `Created` | `string` | Date and time when the error was generated. |
| `Errors` → `Message` | `string` | Descriptive text of the error. |
| `Errors` → `Detail` | `string` | Error detail. |

### Response example

```json
{
    "Response": {
        "PurchaseId": 481561,
        "Created": "2023-08-01T20:53:28.309",
        "TrxToken": null,
        "Order": "099927564",
        "Transaction": {
            "TransactionID": 499285,
            "Created": "2023-08-01T20:53:28.310",
            "AuthorizationDate": "2023-08-01T20:53:28.737",
            "TransactionStatusId": 1,
            "Status": "Approved",
            "ErrorCode": null,
            "Description": "",
            "ApprovalCode": "831000",
            "Steps": [
                {
                    "Step": "Generic External",
                    "Created": "2023-08-01T20:53:28.650",
                    "Status": "Authorization OK - Step 1",
                    "ResponseCode": "200",
                    "ResponseMessage": "OK",
                    "Error": "",
                    "AuthorizationCode": null,
                    "UniqueID": null,
                    "AcquirerResponseDetail": "{\"card\":{\"type\":\"C\",\"issuer\":\"424242\",\"isLocal\":true},\"allowedInstallments\":[1,2,3],\"currency\":858,\"authorizationAmount\":100.0,\"discountAmount\":0.0,\"discountPoints\":0,\"lawLimitApplied\":false,\"code\":0,\"message\":\"ok\"}"
                },
                {
                    "Step": "Generic External",
                    "Created": "2023-08-01T20:53:28.730",
                    "Status": "Authorization OK",
                    "ResponseCode": "100",
                    "ResponseMessage": "ACCEPT",
                    "Error": "",
                    "AuthorizationCode": "831000",
                    "UniqueID": null,
                    "AcquirerResponseDetail": "{\"Decision\":\"ACCEPT\",\"ReasonCode\":\"100\",\"RequestID\":\"386631747\",\"PaymentNetworkTransactionID\":\"016153570198200\",\"CvCode\":null,\"MerchantReferenceCode\":\"20201229\",\"AuthorizationCode\":\"831000\"}"
                }
            ]
        },
        "Capture": true,
        "Amount": 10000,
        "OriginalAmount": 10000,
        "TaxableAmount": 0,
        "Tip": 0,
        "Installments": 1,
        "Currency": "UYU",
        "Description": null,
        "Customer": {
            "CustomerId": 247720,
            "Created": "2023-08-01T20:53:16.073",
            "CommerceCustomerId": null,
            "Owner": "Anonymous",
            "Email": "john@bamboopayment.com",
            "Enabled": true,
            "ShippingAddress": {
                "AddressId": 0,
                "AddressType": 1,
                "Country": "Uruguay",
                "State": "Montevideo",
                "AddressDetail": "Av. Sarmiento 2260",
                "PostalCode": "150000",
                "City": "Montevideo"
            },
            "Plans": null,
            "AdditionalData": null,
            "PaymentProfiles": [
                {
                    "PaymentProfileId": 252393,
                    "PaymentMediaId": 1,
                    "Created": "2023-08-01T20:53:16.073",
                    "LastUpdate": null,
                    "Brand": "VISA",
                    "CardOwner": "John Smith",
                    "Bin": null,
                    "IssuerBank": "Visa",
                    "Installments": "1;2;3;4;5;6;7;8;9;10;11;12",
                    "Type": "CreditCard",
                    "IdCommerceToken": 0,
                    "Token": null,
                    "Expiration": "202605",
                    "Last4": "0001",
                    "Enabled": null,
                    "DocumentNumber": null,
                    "DocumentTypeId": null,
                    "ExternalValue": null,
                    "AffinityGroup": null
                }
            ],
            "CaptureURL": null,
            "UniqueID": null,
            "URL": "https://testapi.siemprepago.com/v1/api/Customer/247720",
            "FirstName": "John",
            "LastName": "Smith",
            "DocNumber": "12345672",
            "DocumentTypeId": 2,
            "PhoneNumber": "24022330",
            "ExternalValue": null
        },
        "RefundList": null,
        "PlanID": null,
        "UniqueID": null,
        "AdditionalData": null,
        "CustomerUserAgent": null,
        "CustomerIP": null,
        "URL": "https://testapi.siemprepago.com/v1/api/Purchase/481561",
        "DataUY": {
            "IsFinalConsumer": "true",
            "Invoice": "1000",
            "TaxableAmount": 0
        },
        "DataDO": null,
        "Acquirer": {
            "AcquirerID": 77,
            "Name": "VisaNetUYv2",
            "CommerceNumber": null
        },
        "CommerceAction": null,
        "PurchasePaymentProfileId": 252393,
        "LoyaltyPlan": null,
        "DeviceFingerprintId": null,
        "MetadataIn": null,
        "MetadataOut": null,
        "CrossBorderData": null,
        "CrossBorderDataResponse": null,
        "Redirection": null,
        "AntifraudData": {
            "AntifraudFingerprintId": null,
            "AntifraudMetadataIn": null
        },
        "PaymentMediaId": null,
        "TargetCountryISO": null,
        "PurchaseType": 1,
        "IsFirstRecurrentPurchase": false
    },
    "Errors": []
}
```